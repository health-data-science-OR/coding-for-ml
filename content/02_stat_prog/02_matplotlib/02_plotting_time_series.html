
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Case Study: ED Time Series &#8212; Python for health data science.</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/02_stat_prog/02_matplotlib/02_plotting_time_series';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Exercises" href="../03_exercises_front_page.html" />
    <link rel="prev" title="Case study: heat map" href="03_cs_hm.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../front_page.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/small_logo.png" class="logo__image only-light" alt="Python for health data science. - Home"/>
    <script>document.write(`<img src="../../../_static/small_logo.png" class="logo__image only-dark" alt="Python for health data science. - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../front_page.html">
                    Preface
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../001_setup/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../001_setup/install.html">Install python and an IDE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../001_setup/git.html">GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../001_setup/conda.html">Conda virtual environment</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../001_setup/prereq.html">Python Prerequisites</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../001_setup/prereq/01_list_comp.html">List comprehensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../001_setup/prereq/02_dicts.html">Dictionarys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../001_setup/prereq/04_scope.html">Variable Scope</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../001_setup/prereq/05_pep8.html">Coding Standards</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Algorithms and computational modelling</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../01_algorithms/01_design.html">The importance of design</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/01_design/01_primes.html">Computing prime numbers</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/01_design/02_better_design.html">Improving the prime sieve code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/01_design/03_micro_opt.html">Do micro-optimisations matter?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/01_design/04_summing_up.html">Summing up</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../01_algorithms/02_oop.html">Designing using objects</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/02_oop/01_python_classes.html">A world of objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/02_oop/02_oop_sim.html">Case study: ABS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/02_oop/03_oop_cv.html">Case study: Cross-validation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../01_algorithms/03_numpy.html">Scientific coding in <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/03_numpy/01_performance.html">Arrays versus lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/03_numpy/02_vectors.html">Vectors and matricies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/03_numpy/03_slicing.html">Array slicing and indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/03_numpy/04_algebra.html">Array algebra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/03_numpy/05_statistics.html">Statistical procedures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/03_numpy/05a_regression.html">Regression using arrays</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/03_numpy/06_sampling.html">Random variables and simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/03_numpy/07_advanced_iter.html">Advanced Array Iteration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/03_numpy/08_cs1.html">Case study 1: a bootstrap routine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/03_numpy/09_cs2.html">Case study 2: prime sieve</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/03_numpy/10_cs3.html">Case study 3: online statistics</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../01_algorithms/04_exercises.html">Exercises</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/04_exercises/01_science_funcs.html">Coding scientific functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/04_exercises/02_basic_oop.html">Basic Object Orientated Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/04_exercises/02_array.html">Working with an <code class="docutils literal notranslate"><span class="pre">np.ndarray</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/04_exercises/04_numpy_stats.html">Statistical procedures in <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../01_algorithms/05_debug.html">Debug challenges</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/05_debug/01_debug_numpy.html"><code class="docutils literal notranslate"><span class="pre">numpy</span></code> debug</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../01_algorithms/06_solutions.html">Solutions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/06_solutions/01_science_funcs.html">Coding scientific functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/06_solutions/02_basic_oop.html">Basic Object Orientated Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/06_solutions/02_array.html">Working with an <code class="docutils literal notranslate"><span class="pre">np.ndarray</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_algorithms/06_solutions/04_numpy_stats.html">Statistical procedures in <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Statistical Programming</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01_pandas_front_page.html">Data wrangling</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../01_pandas/01_intro_pandas.html">Introduction to <strong><code class="docutils literal notranslate"><span class="pre">pandas</span></code></strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_pandas/02_files.html">Working with files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_pandas/03_non_standard_download.html">Case study: a large remote dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_pandas/04_datetimes.html">Managing time series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_pandas/05_analysing.html">Analysing real data sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_pandas/06_cs_combining.html">Case study: Combining multiple sources</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../02_visual_front_page.html">Visualising data</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_matplotlib.html">Introduction to <code class="docutils literal notranslate"><span class="pre">Matplotlib</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="02_matplotlib2.html">Multiple subplots</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_cs_hm.html">Case study: heat map</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Case Study: ED Time Series</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../03_exercises_front_page.html">Exercises</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../03_exercises/00_dataframes.html">Working with a <code class="docutils literal notranslate"><span class="pre">pandas.Dataframe</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_exercises/01_data_wrangling_matplotlib.html">ED data wrangling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_exercises/02_stroke_data_wrangling.html">Stroke data wrangling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_exercises/03_visualise_ts.html">Visualising time series data</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../04_solutions_front_page.html">Solutions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../04_solutions/00_dataframes.html">Working with a <code class="docutils literal notranslate"><span class="pre">pandas.Dataframe</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_solutions/01_data_wrangling_matplotlib_solutions.html">ED Data Wrangling Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_solutions/02_stroke_data_wrangling_solutions.html">Stroke data wrangling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_solutions/03_visualise_ts_SOLUTIONS.html">Visualising time series data</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Managing Data Science Projects</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../03_mgt/03_vc_front_page.html">Version control</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../03_mgt/01_git/02_git.html">Introducing Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_mgt/01_git/03_cs_1.html">Case study: Basic use of Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_mgt/01_git/04_cs_2.html">Case study: roll back and bug fix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_mgt/01_git/05_cs_3.html">Case study: Branching and merging</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../03_mgt/03_mgt_front_page.html">Deployment</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../03_mgt/02_packaging/01_python_packages.html">Local python packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_mgt/03_pypi/01_local.html">Installable Python packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_mgt/03_pypi/02_github.html">Install from GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_mgt/03_pypi/03_pypi.html">Publish a package on PyPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_mgt/03_pypi/04_automation.html">Automation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_mgt/04_binder/01_binder.html">BinderHub</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../03_mgt/04_exercises_front_page.html">Exercises</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../03_mgt/04_exercises/01_python_packages.html">Python package exercise</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_mgt/04_exercises/02_conda.html">Using <code class="docutils literal notranslate"><span class="pre">conda</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_mgt/04_exercises/03_binder.html">Binderhub exercises</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../03_mgt/05_solutions_front_page.html">Solutions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../03_mgt/05_solutions/01_python_packages_solutions.html">Python package exercise</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../appendix/acknowledge.html">Acknowledgements</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix Basic Python</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../appendix/fp_lectures.html">Lectures</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../appendix/lectures/Lecture1.html">Python Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../appendix/lectures/Lecture2.html">Conditionals and Loops</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../appendix/fp_practicals.html">Practicals</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../appendix/labs/01_basics.html">Basic Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../appendix/labs/debug1.html">Debug challenge 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../appendix/labs/02_basics.html">Conditionals and Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../appendix/labs/debug2.html">Debug challenge 2</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/health-data-science-OR/coding-for-ml/main?urlpath=lab/tree/content/02_stat_prog/02_matplotlib/02_plotting_time_series.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/health-data-science-OR/coding-for-ml/blob/main/content/02_stat_prog/02_matplotlib/02_plotting_time_series.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/health-data-science-OR/coding-for-ml" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/health-data-science-OR/coding-for-ml/issues/new?title=Issue%20on%20page%20%2Fcontent/02_stat_prog/02_matplotlib/02_plotting_time_series.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/content/02_stat_prog/02_matplotlib/02_plotting_time_series.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Case Study: ED Time Series</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-add-plotting-before-forecasting">Exploring add plotting before forecasting.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-ed-arrivals-dataset">The ED arrivals dataset.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-use-pandas-and-matplotlib-to-visualise-a-time-series">How to use Pandas and Matplotlib to visualise a time series</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#improving-the-appearance-of-your-time-series-plot">Improving the appearance of your time series plot</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-seaborn">Using Seaborn</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualising-monthly-data-after-adjusting-for-days-in-the-month">Visualising monthly data after adjusting for days in the month</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-a-smoother-through-the-time-series">Run a smoother through the time series.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#breaking-a-times-series-up-into-its-trend-and-seasonal-components">Breaking a times series up into its trend and seasonal components.</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#additive-decomposition">Additive decomposition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#multiplicative-decomposition">Multiplicative decomposition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-components">Plotting the components</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="case-study-ed-time-series">
<h1>Case Study: ED Time Series<a class="headerlink" href="#case-study-ed-time-series" title="Link to this heading">#</a></h1>
<section id="exploring-add-plotting-before-forecasting">
<h2>Exploring add plotting before forecasting.<a class="headerlink" href="#exploring-add-plotting-before-forecasting" title="Link to this heading">#</a></h2>
<p>Let’s assume you are interested in forecasting the daily number of emergency department attendences at a hospital.  Before that is attempted it is important to understand a time series.  Exploring the time series using <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> is a good way to gain an understanding.</p>
<p>In this case study you will learn how to:</p>
<ul class="simple">
<li><p>Plot a time series</p></li>
<li><p>Adjust monthly time series to account for the different number of days</p></li>
<li><p>Run a smoother through the time series to assess trend.</p></li>
<li><p>Break a time series into its trend and seasonal components.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
<span class="kn">import</span> <span class="nn">matplotlib.style</span> <span class="k">as</span> <span class="nn">style</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.seasonal</span> <span class="kn">import</span> <span class="n">seasonal_decompose</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-ed-arrivals-dataset">
<h2>The ED arrivals dataset.<a class="headerlink" href="#the-ed-arrivals-dataset" title="Link to this heading">#</a></h2>
<p>The dataset we will use represent monthly adult (age &gt; 18) arrivals to an Emergency Department.  The synthetic observations are based on real data between April 2009 and May 2017.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DATA_URL</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/health-data-science-OR/&#39;</span> \
            <span class="o">+</span> <span class="s1">&#39;hpdm097-datasets/master/ed_mth_ts.csv&#39;</span>
<span class="n">ed_month</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DATA_URL</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ed_month</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;MS&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>The first thing you should do when exploring a time series is check its length and duration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#This tells us how many months are in the ts</span>
<span class="n">ed_month</span><span class="o">.</span><span class="n">shape</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(98, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#the minimum date</span>
<span class="n">ed_month</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Timestamp(&#39;2009-04-01 00:00:00&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#the maximum date</span>
<span class="n">ed_month</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Timestamp(&#39;2017-05-01 00:00:00&#39;)
</pre></div>
</div>
</div>
</div>
<section id="how-to-use-pandas-and-matplotlib-to-visualise-a-time-series">
<h3>How to use Pandas and Matplotlib to visualise a time series<a class="headerlink" href="#how-to-use-pandas-and-matplotlib-to-visualise-a-time-series" title="Link to this heading">#</a></h3>
<p>Pandas implements matplotlib functionality as part of its <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. The quickest way to visualise a time series in Python is therefore to call the <code class="docutils literal notranslate"><span class="pre">plot()</span></code> method of a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">plot()</span></code> method takes a tuple parameter called <code class="docutils literal notranslate"><span class="pre">figsize</span></code>. The tuple represents the (length, height) of the image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ed_month</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;date&#39;&gt;
</pre></div>
</div>
<img alt="../../../_images/b66bc6b4261ac65d4c8327088e7b86957cad264c05c75ea603b08bfe690e055d.png" src="../../../_images/b66bc6b4261ac65d4c8327088e7b86957cad264c05c75ea603b08bfe690e055d.png" />
</div>
</div>
<p>You can then easily to save a high resolution image to file if you would like to use it in a report.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">ed_month</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;explore.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/b66bc6b4261ac65d4c8327088e7b86957cad264c05c75ea603b08bfe690e055d.png" src="../../../_images/b66bc6b4261ac65d4c8327088e7b86957cad264c05c75ea603b08bfe690e055d.png" />
</div>
</div>
</section>
<section id="improving-the-appearance-of-your-time-series-plot">
<h3>Improving the appearance of your time series plot<a class="headerlink" href="#improving-the-appearance-of-your-time-series-plot" title="Link to this heading">#</a></h3>
<p>Matplotlib is very flexible. The full functionality is beyond the scope of this tutorial and it is recommended to review the matplotlib site for examples.  Here we recommend the following parameters to help manipulate your plot.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">color</span></code> e.g. ‘green’, ‘blue’ or ‘orange’</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">linestyle</span></code> e.g. ‘–’ for dashed, ‘-.’ for dash-dot, or ‘’ for none.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">linewidth</span></code> - a number - typically 1, 1.5 or 2 will do.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">marker</span></code> - e.g. ‘o’ for dots, ‘+’ for crosses, ‘^’ for triangle, and ‘’ for none.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ed_month</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> 
              <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;date&#39;&gt;
</pre></div>
</div>
<img alt="../../../_images/f63623785475b00101240dc9b15a56f6c2f16785c1f11979a82aa1ad928b0760.png" src="../../../_images/f63623785475b00101240dc9b15a56f6c2f16785c1f11979a82aa1ad928b0760.png" />
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">plot</span></code> method returns an <code class="docutils literal notranslate"><span class="pre">axis</span></code> object. You can use this to manipulate the plot.  The following is often useful for time series plots.</p>
<ul class="simple">
<li><p>The y and x scale</p></li>
<li><p>The y and x label.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">ed_month</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;attendances&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12_000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/23d82c4e56bb2e93462abc8554a673410102908dd0a997dc388efc0747785f6a.png" src="../../../_images/23d82c4e56bb2e93462abc8554a673410102908dd0a997dc388efc0747785f6a.png" />
</div>
</div>
<section id="using-seaborn">
<h4>Using Seaborn<a class="headerlink" href="#using-seaborn" title="Link to this heading">#</a></h4>
<p>You can also use the <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> package to improve the default appearance of your <code class="docutils literal notranslate"><span class="pre">maplotlib</span></code> charts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;seaborn&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">ed_month</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/cdffd613c25e1437f550e2a859f604d5c6e835b486273cde0863258a7f30b9eb.png" src="../../../_images/cdffd613c25e1437f550e2a859f604d5c6e835b486273cde0863258a7f30b9eb.png" />
</div>
</div>
</section>
</section>
<section id="visualising-monthly-data-after-adjusting-for-days-in-the-month">
<h3>Visualising monthly data after adjusting for days in the month<a class="headerlink" href="#visualising-monthly-data-after-adjusting-for-days-in-the-month" title="Link to this heading">#</a></h3>
<p>When you are working with monthly data, some of the noise you are seeing the time series is due to months having a different number of days.  This makes forecasting harder than it needs to be.  Adjusting the time series by dividing by the number of days per month removes that noise.</p>
<p>This is very straightforward in pandas, using the built in property <code class="docutils literal notranslate"><span class="pre">DateTimeIndex.days_in_month</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arrival_rate</span> <span class="o">=</span> <span class="n">ed_month</span><span class="p">[</span><span class="s1">&#39;arrivals&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">ed_month</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">days_in_month</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arrival_rate</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>date
2009-04-01    298.266667
2009-05-01    305.709677
2009-06-01    313.900000
2009-07-01    306.967742
2009-08-01    281.612903
Freq: MS, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ed_month</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>arrivals</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2009-04-01</th>
      <td>8948</td>
    </tr>
    <tr>
      <th>2009-05-01</th>
      <td>9477</td>
    </tr>
    <tr>
      <th>2009-06-01</th>
      <td>9417</td>
    </tr>
    <tr>
      <th>2009-07-01</th>
      <td>9516</td>
    </tr>
    <tr>
      <th>2009-08-01</th>
      <td>8730</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Note that the units of the time series are now ‘<em>attendances / per day</em>’.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">ed_month</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/cdffd613c25e1437f550e2a859f604d5c6e835b486273cde0863258a7f30b9eb.png" src="../../../_images/cdffd613c25e1437f550e2a859f604d5c6e835b486273cde0863258a7f30b9eb.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">arrival_rate</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/177198e92c1ae853f98a49f42f9052f33bcaad08ed280c6006efe06507180925.png" src="../../../_images/177198e92c1ae853f98a49f42f9052f33bcaad08ed280c6006efe06507180925.png" />
</div>
</div>
</section>
</section>
<section id="run-a-smoother-through-the-time-series">
<h2>Run a smoother through the time series.<a class="headerlink" href="#run-a-smoother-through-the-time-series" title="Link to this heading">#</a></h2>
<p>Time series are subject to seasonal patterns and noise.  To help explore the trend in the data you can smooth the time series using a moving average.</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">rolling()</span></code> method of a pandas dataframe to create a moving average.</p>
<p>We will run a 12 month moving average through the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ma12</span> <span class="o">=</span> <span class="n">arrival_rate</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">arrival_rate</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;observations&#39;</span><span class="p">)</span>
<span class="n">ma12</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Smoothed Observations (MA_12)&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;attends/day&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/4069cbd25ea8ce7d044defdb4a88c90ca36b7d8bbfd6709294a279a4d4af126c.png" src="../../../_images/4069cbd25ea8ce7d044defdb4a88c90ca36b7d8bbfd6709294a279a4d4af126c.png" />
</div>
</div>
<section id="breaking-a-times-series-up-into-its-trend-and-seasonal-components">
<h3>Breaking a times series up into its trend and seasonal components.<a class="headerlink" href="#breaking-a-times-series-up-into-its-trend-and-seasonal-components" title="Link to this heading">#</a></h3>
<p>To help visualise and understand trend and seasonality in a time series we can use seasonal decomposition.</p>
<p>This is a model based approach that breaks the time series into three components.  The basic approach to seasonal decomposition has two forms: additive and multiplicative.</p>
<section id="additive-decomposition">
<h4>Additive decomposition<a class="headerlink" href="#additive-decomposition" title="Link to this heading">#</a></h4>
<p>If we assume that an observation at time t <span class="math notranslate nohighlight">\(Y_t\)</span> is the additive sum of trend <span class="math notranslate nohighlight">\(T_t\)</span>, seasonality <span class="math notranslate nohighlight">\(S_t\)</span> and random error <span class="math notranslate nohighlight">\(E_t\)</span>.  then we have the following model.</p>
<p><span class="math notranslate nohighlight">\(Y_t = T_t + S_t + E_t\)</span></p>
<p>We then to make this assumption when the seasonal fluctuations are constant across the time series.  This looks like a reasonable assumption in the case of the ED data.</p>
</section>
<section id="multiplicative-decomposition">
<h4>Multiplicative decomposition<a class="headerlink" href="#multiplicative-decomposition" title="Link to this heading">#</a></h4>
<p>If the seasonal fluctuations of the data grow over time then it is best to a multiplicative model. Where an observation at time t <span class="math notranslate nohighlight">\(Y_t\)</span> is the product of multiply the trend <span class="math notranslate nohighlight">\(T_t\)</span>, seasonality <span class="math notranslate nohighlight">\(S_t\)</span> and random error <span class="math notranslate nohighlight">\(E_t\)</span></p>
<p><span class="math notranslate nohighlight">\(Y_t = T_t \cdot  S_t \cdot  E_t\)</span></p>
<p>Python has a built in seasonal decomposition method for you to use.  It can be imported from <code class="docutils literal notranslate"><span class="pre">statsmodels.tsa.seasonal.seasonal_decompose</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#its easy to use. Pass in the ts and specify the model</span>
<span class="n">decomp</span> <span class="o">=</span> <span class="n">seasonal_decompose</span><span class="p">(</span><span class="n">arrival_rate</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;additive&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plotting-the-components">
<h4>Plotting the components<a class="headerlink" href="#plotting-the-components" title="Link to this heading">#</a></h4>
<p>The results of the seasonal decomposition include dataframes containing the trend and seasonality components.  As they are dataframe they can be plotted in the same manner as the raw data.</p>
<p><strong>Plotting Trend</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">decomp</span><span class="o">.</span><span class="n">trend</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;date&#39;&gt;
</pre></div>
</div>
<img alt="../../../_images/8ef6e6ef3880490843f191764f5d5ba18f19c3855056912765d123ee1c5bcd60.png" src="../../../_images/8ef6e6ef3880490843f191764f5d5ba18f19c3855056912765d123ee1c5bcd60.png" />
</div>
</div>
<p><strong>Plotting Seasonality</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">decomp</span><span class="o">.</span><span class="n">seasonal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;date&#39;&gt;
</pre></div>
</div>
<img alt="../../../_images/1a5afbbd8591801307b2a8ca33e038382ead795ca81b04ac11f9bfa6fc1941eb.png" src="../../../_images/1a5afbbd8591801307b2a8ca33e038382ead795ca81b04ac11f9bfa6fc1941eb.png" />
</div>
</div>
<p><strong>Residuals (error)</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">decomp</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;date&#39;&gt;
</pre></div>
</div>
<img alt="../../../_images/c436b62145dcd238415e62389f0ee8bd56f6535ef31e12df8441162d2bd64367.png" src="../../../_images/c436b62145dcd238415e62389f0ee8bd56f6535ef31e12df8441162d2bd64367.png" />
</div>
</div>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "health-data-science-OR/coding-for-ml",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content/02_stat_prog/02_matplotlib"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="03_cs_hm.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Case study: heat map</p>
      </div>
    </a>
    <a class="right-next"
       href="../03_exercises_front_page.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Exercises</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-add-plotting-before-forecasting">Exploring add plotting before forecasting.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-ed-arrivals-dataset">The ED arrivals dataset.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-use-pandas-and-matplotlib-to-visualise-a-time-series">How to use Pandas and Matplotlib to visualise a time series</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#improving-the-appearance-of-your-time-series-plot">Improving the appearance of your time series plot</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-seaborn">Using Seaborn</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualising-monthly-data-after-adjusting-for-days-in-the-month">Visualising monthly data after adjusting for days in the month</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-a-smoother-through-the-time-series">Run a smoother through the time series.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#breaking-a-times-series-up-into-its-trend-and-seasonal-components">Breaking a times series up into its trend and seasonal components.</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#additive-decomposition">Additive decomposition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#multiplicative-decomposition">Multiplicative decomposition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-components">Plotting the components</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Thomas Monks
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>